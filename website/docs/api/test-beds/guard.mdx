---
title: Guard
---





import TabItem from '@theme/TabItem';
import Tabs from '@theme/Tabs';

# Guard TestBed

Custom test bed for testing guard.

**Quick example**

[//]: # (@formatter:off)
<Tabs groupId="guard-type">

  <TabItem value="function">
    ```ts
    describe('AUTH_GUARD', () => {
      const tb = guardTestBed(AUTH_GUARD, { type: 'CanActivate' })
        .provide(AuthService)
        .inject('auth', AuthService);

      it('should not activate if logged', tb(({ challenge, injected: { auth } }) => {
        const result1 = challenge();
        expect(result1).toBeFalse();

        auth.isLogin = true;

        const result2 = challenge();
        expect(result2).toBeTrue();
      }));
    });
    ```
  </TabItem>

  <TabItem value="Class">
  ```ts
  describe('AuthGuard', () => {
    const tb = guardTestBed(AuthGuard)
      .provide(AuthService)
      .inject('auth', AuthService);

    it('should not activate if logged', tb(({ challenge, injected: { auth } }) => {
      const result1 = challenge();
      expect(result1).toBeFalse();

      auth.isLogin = true;

      const result2 = challenge();
      expect(result2).toBeTrue();
    }));
  });
  ```
  </TabItem>
</Tabs>
[//]: # (@formatter:on)

## `guardTestBed(..)`

Creates a specific test bed for router.

It returns a function to be used to wrap `it`'s callback and from which you access tools (check [GuardTools](#assertion-tools)).

[//]: # (@formatter:off)
<Tabs groupId="guard-type">

  <TabItem value="function">
    ```ts
    describe('AUTH_GUARD', () => {
      const tb = guardTestBed(AUTH_GUARD, { type: 'CanActivate' })

      it('should ', tb((tools) => { // ðŸ‘ˆ tb function used here
        // ... expectations
      }));
    });
    ```
  </TabItem>

  <TabItem value="Class">
    ```ts
    describe('AuthGuard', () => {
      const tb = guardTestBed(AuthGuard)

      it('should ', tb((tools) => { // ðŸ‘ˆ tb function used here
        // ... expectations
      }));
    });
    ```
  </TabItem>
</Tabs>
[//]: # (@formatter:on)

`tb` function supports the jasmine `DoneFn` and async/await notation.

```ts
describe('AuthGuard', () => {
  const tb = guardTestBed(AuthGuard);

  it('should ', tb(async (tools) => {
    // ... async expectations
  }));

  it('should ', tb((tools, done) => {
    // ... expectations
    done();
  }));
});
```

## TestBed Options

```ts
describe('AuthGuard', () => {
  const tb = guardTestBed(AuthGuard, {} /* ðŸ‘ˆ here */);

  it('should ', tb(() => {
    // ... expectations
  }));
});
```

### `type`

**Default** : `undefined`

Specifies the type of guard being tested.

:::info
Required for guard functions and optional for guard classes.

Recommanded for guard classes that implement many interfaces to choose what guard mecanism will be performed by the tools.
:::

Example :

<Tabs groupId="guard-type">

  <TabItem value="function">
    ```ts
    const tb = guardTestBed(AUTH_GUARD, {type: 'CanMatch'});
    ```
  </TabItem>

  <TabItem value="Class">
    ```ts
    const tb = guardTestBed(AuthGuard, {type: 'CanMatch'});
    ```
  </TabItem>
</Tabs>

### `imports`

**Default** : `[]`

Imports dependencies for the described guard.

Example :

```ts
const tb = guardTestBed(AuthGuard, {
  imports: [SharedModule, AuthModule],
});
```

### `providers`

**Default** : `[]`

List of providers to be available during tests for the described guard.

Example :

```ts
const tb = guardTestBed(AuthGuard, {
  providers: [AppService, { provide: StoreService, useClass: MockStoreService }],
});
```

### `httpTesting`

**Default** : `false`

Enables [HttpTestingTools](../common/http-testing-tools).

### `verifyHttp`

**Default** : `true`

When enabled, each assertion will end by `HttpTestingController.verify()`.

:::warning
Works only if [httpTesting](#httptesting) is `true`, otherwise has no effect.
:::

### `autoCompile`

**Default** : `true`

Automatically compiles the custom test bed for each test.

### `checkCreate`

**Default** : `true`

Automatically invokes the "should create" Angular test.

It checks if the provided described instance is truthy.

## Assertion tools

The tb function provides `GuardTools`.

```ts
describe('AuthGuard', () => {
  const tb = guardTestBed(AuthGuard);

  it('should ', tb((tools /* ðŸ‘ˆ here */) => {
    // ... expectations
  }));
});
```

ðŸ‘‰ `GuardTools` extends **[BaseTools](../common/base-tools)** and **[HttpTestingTools](../common/http-testing-tools)**.

### `guard`

The described router routes.

Example :

```ts
it('should ', tb(({ guard }) => {
  // ... expectations
}));
```

### `challenge`

The current router url as a [`Signal`](https://angular.dev/guide/signals).

Example :

```ts
it('should ', tb(({ $url }) => {
  expect($url()).toEqual('/home');
}));
```

## Assertion options

For specific test, you enable/disable options that override the test bed options.

```ts
describe('AuthGuard', () => {
  const tb = guardTestBed(AuthGuard);

  it('should ', tb((tools) => {
    // ... expectations
  }, {} /* ðŸ‘ˆ here */));
});
```

### `verifyHttp`

Same as [options verifyHttp](#verifyHttp) but **only for the current assertion**.

## `GuardTestBed`

### `import(..)`

Same as [options imports](#imports) but with chaining methods.

Example :

```ts
describe('AuthGuard', () => {
  const tb = guardTestBed(AuthGuard)
    .import(AppModule)
    .import([SharedModule, ThirdPartyModule]);
});
```

### `provide(..)`

Same as [options providers](#providers) but with chaining methods.

Example :

```ts
describe('AuthGuard', () => {
  const tb = guardTestBed(AuthGuard)
    .provide(AppService)
    .provide([StoreService, { provide: MY_TOKEN, useValue: mockValue }]);
});
```

### `inject(..)`

Links an injected instance to a key and retrieve it into the enhanced tools by autocompletion.

```ts
describe('AuthGuard', () => {
  const tb = guardTestBed(AuthGuard)
    .inject('auth', AuthService);

  it('should ', tb(({ injected: { auth } }) => {
    // ... expectations
  }));
});
```

### `setup(..)`

Setups extra action using the enhanced tools.

Works only for `beforeEach` and `afterEach`.

```ts
describe('AuthGuard', () => {
  const tb = guardTestBed(AuthGuard);

  beforeEach(tb.setup(({ guard }) => {
    guard.foo = true;
  }));
});
```

### `compile()`

To be used when you need to do third party setups before compiling the custom test bed.

:::warning
It has to be used into `beforeEach(..)` and [autoCompile](#autocompile) must be set to `false`.
:::

```ts
describe('AuthGuard', () => {
  const tb = guardTestBed(AuthGuard, { autoCompile: false });

  beforeEach(async () => {
    // ... third party setup
    await tb.compile();
  });
});
```
